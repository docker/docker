#!/bin/bash
set -e

# Retrieve OS/ARCH of docker daemon, eg. linux/amd64
export DOCKER_ENGINE_OSARCH="$(docker version | awk -F ": ?" '
	$1 == "Server" { server = 1; next }
	$1 == "OS/Arch (server)" { print $2; next; }
	server && $1 == " OS/Arch" { gsub(/^[ \t]+/,"",$2); print $2 ; server = 0 }
')"
export DOCKER_ENGINE_GOOS="${DOCKER_ENGINE_OSARCH%/*}"
export DOCKER_ENGINE_GOARCH="${DOCKER_ENGINE_OSARCH##*/}"

# and the client, just in case
export DOCKER_CLIENT_OSARCH="$(docker version | awk -F ": ?" '
        $1 == "Client" { client = 1; next }
        $1 == "OS/Arch (client)" { print $2; next; }
        client && $1 == " OS/Arch" { gsub(/^[ \t]+/,"",$2); print $2 ; client = 0 }
')"
