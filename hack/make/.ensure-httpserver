#!/bin/bash
set -e

# Build a Go static web server on top of busybox image
# and compile it for target daemon

MACHINE=`uname -m`
if [ $MACHINE != "ppc64le" ]; then
    MACHINE="amd64"
fi

dir="$DEST/httpserver"
mkdir -p "$dir"
(
	cd "$dir"
	GOOS="linux" GOARCH=$MACHINE go build -o httpserver github.com/docker/docker/contrib/httpserver
	cp ../../../../contrib/httpserver/Dockerfile .
	docker build -qt httpserver . > /dev/null
)
rm -rf "$dir"
